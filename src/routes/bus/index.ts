import { Request, Response, Router } from "express";
import qrcode from "qrcode";
import Credentials from "../../database/Credentials";
import PRequests from "../../database/PresentationRequests";
import PresentationRequestTemplates from "../../database/PresentationRequestTemplates";
import Submissions from "../../database/PresentationSubmissions";
import createCredential from "../../utils/createCredential";
import createPresentationRequest from "../../utils/createPresentationRequest";
import fetchSubmission from "../../utils/fetchSubmission";
import generateRandomString from "../../utils/generateRandomString";

const router = Router();

router.get("/pr", async (req: Request, res: Response) => {
  const prt = await PresentationRequestTemplates.findOne({});
  const cityTemplateId = (prt as any).city as string;
  const degreeTemplateId = (prt as any).degree as string;

  const templateIds = [cityTemplateId, degreeTemplateId];

  const pr = await createPresentationRequest(templateIds);
  const show = {
    requestType: "presentationRequest",
    pr,
  };
  const prmodel = await PRequests.findOne({});
  (prmodel as any).bus = pr.id;
  await prmodel.save();

  const prQR = await qrcode.toDataURL(JSON.stringify(show));
  return res.json({
    qrcode: prQR,
  });
});

router.get("/poll", async (req: Request, res: Response) => {
  const prmodel = await PRequests.findOne({});

  const response = await fetchSubmission((prmodel as any).bus);

  if (response === "NA") {
    return res.sendStatus(400);
  } else {
    const submission = await Submissions.findOne({});
    (submission as any).bus = response;
    await submission.save();
    return res.sendStatus(200);
  }
});

router.post("/cred", async (req: Request, res: Response) => {
  const c = await Credentials.findOne({});
  const did = (c as any).did;

  const unsignedVC = {
    "@context": [
      "https://www.w3.org/2018/credentials/v1",
      "https://schema.org",
    ],
    type: ["VerifiableCredential", "FlexLandCityTransitCredential"],
    name: "City Transit",
    credentialSubject: {
      id: did,
      transitId: generateRandomString(15),
    },
    image: "data:image/png;base64,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",
    issuerOrganization: "Ministry of Transit",
    issuer: process.env.ORG_DID,
    saveToBank: true,
    isRevocable: false,
  };

  const signedVc = await createCredential(unsignedVC);
  (c as any).busId = signedVc;
  await c.save();

  const saveRequest = {
    requestType: "credentialSave",
    vc: signedVc,
  };

  const vcQR = await qrcode.toDataURL(JSON.stringify(saveRequest));
  return res.json({
    qrcode: vcQR,
  });
});

export default router;
