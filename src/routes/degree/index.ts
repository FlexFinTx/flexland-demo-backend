import { Request, Response, Router } from "express";
import qrcode from "qrcode";
import Credentials from "../../database/Credentials";
import PRequests from "../../database/PresentationRequests";
import PresentationRequestTemplates from "../../database/PresentationRequestTemplates";
import Submissions from "../../database/PresentationSubmissions";
import createCredential from "../../utils/createCredential";
import createPresentationRequest from "../../utils/createPresentationRequest";
import fetchSubmission from "../../utils/fetchSubmission";
import generateRandomString from "../../utils/generateRandomString";

const router = Router();

router.get("/pr", async (req: Request, res: Response) => {
  const prt = await PresentationRequestTemplates.findOne({});
  const cityTemplateId = (prt as any).city as string;

  const templateIds = [cityTemplateId];

  const pr = await createPresentationRequest(templateIds);

  const show = {
    requestType: "presentationRequest",
    pr,
  };

  const prmodel = await PRequests.findOne({});
  (prmodel as any).degree = pr.id;
  await prmodel.save();

  const prQR = await qrcode.toDataURL(JSON.stringify(show));
  return res.json({
    qrcode: prQR,
  });
});

router.get("/poll", async (req: Request, res: Response) => {
  const prmodel = await PRequests.findOne({});

  const response = await fetchSubmission((prmodel as any).degree);

  if (response === "NA") {
    return res.sendStatus(400);
  } else {
    const submission = new Submissions({
      degree: response,
    });
    await submission.save();
    return res.sendStatus(200);
  }
});

router.post("/cred", async (req: Request, res: Response) => {
  const c = await Credentials.findOne({});
  const did = (c as any).did;

  const unsignedVC = {
    "@context": [
      "https://www.w3.org/2018/credentials/v1",
      "https://schema.org",
    ],
    name: "Degree",
    image: "data:image/png;base64,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",
    issuerOrganization: "University of FlexLand",
    type: ["VerifiableCredential", "FlexLandUniversityDegreeCredential"],
    credentialSubject: {
      id: did,
      alumniOf: "University of FlexLand",
      degree: "Bachelors of Science",
    },
    issuer: process.env.ORG_DID,
    saveToBank: true,
    isRevocable: false,
  };

  const signedVc = await createCredential(unsignedVC);
  (c as any).degreeId = signedVc;
  await c.save();

  const saveRequest = {
    requestType: "credentialSave",
    vc: signedVc,
  };

  const vcQR = await qrcode.toDataURL(JSON.stringify(saveRequest));
  return res.json({
    qrcode: vcQR,
  });
});

export default router;
